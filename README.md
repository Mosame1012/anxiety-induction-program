# 焦虑诱发实验程序

一个基于Web的标准化焦虑诱发实验程序，采用视听刺激方式探索焦虑情绪的诱发效果及测量方法。

## 项目简介

本程序旨在通过标准化流程诱发参与者的焦虑状态，并量化评估诱发效果。程序采用单次前后测设计，通过呈现经过验证的情绪性材料（图片和音频）引发焦虑反应，并借助标准化心理量表（VAS、SAI）进行测量。

## 项目主要变化（v2.0）

相较于初始版本，本项目进行了重要的算法优化和架构调整：

### 1. 核心参数优化
- **总时长调整**: 从5-7分钟优化为严格控制在5-7分钟范围内（300-420秒）
- **刺激数量调整**: 从9-13个扩展为8-14个，提供更大的灵活性
- **间隔时间规范化**: 从10-70秒严格调整为10-60秒，确保实验一致性

### 2. 智能时间-刺激映射系统
- 新增`getStimulusCountRange()`函数，根据总时间动态确定刺激数量范围
- 系统自动调整请求的刺激数量，确保始终满足间隔要求
- 避免了因时间不足导致的间隔过小问题

### 3. 分布模式精简与优化
- **保留的模式**（3种，容易实现）:
  - 前密后疏：前期密集（40-50%），后期稀疏（20-25%），成功率约90%
  - 前疏后密：前期稀疏（20-25%），后期密集（40-50%），成功率约75%
  - 均匀随机：均匀分布（30-40%），成功率约95%
- **暂缓实现的模式**（2种，难以满足10-60秒间隔要求）:
  - 中间密集：中间50%时间需要50-60%刺激，导致间隔<10秒
  - 双峰密集：需要两个密集区，导致密集区间隔过小

### 4. 算法性能提升
- 模拟测试成功率从85.71%提升到100%（20轮测试全部通过）
- 实现了严格的间隔验证，所有间隔必须在10-60秒范围内
- 优化了区块刺激分配算法，减少了超时和间隔冲突

### 5. 新增辅助工具
- `test_algorithm.js`: 算法测试工具，用于验证所有参数组合的可行性
- `simulate.js`: 模拟程序，生成多轮刺激时间序列，便于预览和调试
- `pattern_analysis.md`: 详细的分布模式分析报告，包含优化建议

## 实验流程

### 预计总时长：11-13分钟

1. **介绍页面** - 展示研究目的、实验流程、警告信息和免责声明
2. **EEG准备说明** - 为正式实验提供EEG设备准备步骤（可选）
3. **第一阶段：基线评估（约3分钟）**
   - 填写视觉模拟量表（VAS），评估当前主观焦虑程度
   - 完成状态焦虑量表（SAI）的前测部分
   - 注：在正式实验中，此阶段前先记录脑电（EEG）信号

4. **第二阶段：焦虑诱发环节（5~7分钟）**
   - 参与者注视屏幕中央的白色十字
   - 系统在不可预测的时间点呈现令人不适的图片和不悦的音频片段
   - 每次实验随机呈现8-14个刺激材料(根据总时间自动调整)
   - 刺激间隔时间严格控制在10-60秒之间
   - 采用三种分布模式（前密后疏、前疏后密、均匀随机）模拟不同的焦虑诱发情境
   - 系统会根据总时间自动映射刺激数量范围,确保间隔要求得到满足
   - 刺激材料选自国际情绪图片系统（IAPS）和国际情感数字声音系统（IADS）
   - 参与者可随时点击"结束"按钮中止实验

5. **第三阶段：诱发后评估（约3分钟）**
   - 再次填写VAS量表
   - 完成SAI量表的后测部分
   - 注：在正式实验室环境中，此阶段将继续记录EEG信号

6. **第四阶段：结果反馈**
   - 系统自动分析前后测数据
   - 显示焦虑水平变化值及简要解释

## 技术特点

- **纯前端实现**：无需后端服务器，数据存储于浏览器本地
- **响应式设计**：适配不同设备，确保实验环境一致性
- **多媒体预加载**：避免延迟影响实验信度
- **智能时间分配**：根据总时间自动映射刺激数量范围,确保间隔严格在10-60秒之间
- **多种分布模式**：实现三种容易的分布模式(前密后疏、前疏后密、均匀随机),成功率85%+
- **动态参数调整**：算法会根据总时间和刺激数量自动调整参数,避免冲突

## 设计原则与亮点

本程序在设计过程中充分考虑了EEG实验的特殊需求，遵循以下核心设计原则：

### 1. 简化实验范式，减少EEG干扰因素

**设计理念**：EEG信号对运动、认知活动等复杂因素高度敏感，因此实验范式尽可能简化，以减少对EEG信号的干扰。

**具体体现**：
- **单一任务聚焦**：焦虑诱发环节仅要求参与者注视屏幕中央的十字，无需执行其他认知任务
- **最小化交互操作**：除必要的量表填写外，实验过程中不要求参与者进行复杂的操作或决策
- **标准化刺激呈现**：采用固定时间节点呈现刺激，避免参与者产生预期和主动调节
- **避免多任务干扰**：实验流程线性清晰，不引入分心任务或记忆负荷

### 2. 对称化前后测量设计

**设计理念**：为了确保EEG前后测数据的可比性，前后测量环节在时间、任务和环境上尽可能对称。

**具体体现**：
- **时间对称**：前测和后测均使用相同的量表（VAS、SAI），填写时间相近（约3分钟）
- **环境对称**：前后测均在相同的页面布局和视觉环境中进行
- **EEG记录对称**：前后测阶段的EEG记录时长和状态保持一致（静息状态）
- **流程对称**：前测和后测前均提供EEG准备/监测说明，确保实验流程的一致性
- **刺激间隔对称**：EEG记录期间均避免呈现任何视觉或听觉刺激

### 3. 夜间模式设计，减少光亮和颜色刺激

**设计理念**：光线和颜色是重要的环境刺激因素，可能影响参与者的情绪状态和EEG信号。采用夜间模式设计，最大程度减少视觉刺激对实验结果的干扰。

**具体体现**：
- **深色背景**：使用低饱和度的暖灰色系（#3A3530、#2A2520）作为主背景色，减少光亮刺激
- **柔和配色**：整体采用米灰色系（#E8E4DC、#D8D4CC、#C8C4BC），避免高饱和度颜色
- **低对比度设计**：文字与背景的对比度适中，既保证可读性又不造成视觉疲劳
- **避免情绪引导**：不使用红色、蓝色等可能引导情绪的颜色，保持视觉中性
- **舒适视觉体验**：夜间模式在减少刺激的同时，提供比纯黑白灰更舒适的视觉体验

**设计价值**：
- 减少光线变化对EEG信号的影响
- 避免颜色刺激对情绪状态的干扰
- 提高参与者在长时间实验中的舒适度
- 确保实验环境的一致性和标准化

## 文件结构

```
焦虑诱发程序/
├── index.html              # 主HTML文件（实验界面）
├── style.css               # CSS样式文件（夜间模式设计）
├── script.js               # JavaScript逻辑文件（核心算法）
│
├── test_algorithm.js       # 算法测试工具
├── simulate.js             # 刺激时间模拟程序
├── pattern_analysis.md     # 分布模式分析报告
│
├── audio/                  # 音频文件目录
│   ├── stimulus_01.mp3
│   ├── stimulus_02.mp3
│   └── ... (共20个)
│
└── images/                 # 图片文件目录
    ├── stimulus_01.png
    ├── stimulus_02.png
    └── ... (共20个)
```

## 辅助工具使用说明

### 1. test_algorithm.js - 算法测试工具

**用途**: 验证算法在各种参数组合下的可行性

**使用方法**:
```bash
node test_algorithm.js
```

**测试内容**:
- 所有刺激数量组合（7-11个）
- 所有总时间组合（300/360/420秒）
- 所有分布模式（前密后疏、前疏后密、均匀随机）
- 严格验证间隔是否在10-60秒范围内

**输出示例**:
```
✓ 前密后疏 - 8个刺激, 300秒 - 成功生成8个刺激
✗ 前疏后密 - 9个刺激, 300秒 - 失败: 间隔超出范围: 8秒

=== 测试结果 ===
总测试数: 75
通过: 65
失败: 10
成功率: 86.67%
```

**适用场景**:
- 修改算法参数后验证可行性
- 调试间隔超时问题
- 评估算法优化效果

### 2. simulate.js - 刺激时间模拟程序

**用途**: 生成多轮刺激时间序列，预览实验效果

**使用方法**:
```bash
node simulate.js
```

**输出内容**:
- 每轮的总时间、刺激数量、使用的模式
- 刺激出现时间（秒）
- 刺激间隔时间（秒）
- 间隔范围统计
- 模式分布统计
- 整体验证结果

**输出示例**:
```
第 1 轮:
  总时间: 363秒 (6分钟)
  刺激数量: 14个
  模式: 前密后疏
  刺激时间: [31, 48, 64, 83, 102, 117, 140, 170, 190, 217, 282, 311, 334, 349]
  间隔时间: [12, 11, 14, 14, 10, 18, 25, 15, 22, 60, 24, 18, 10]
  间隔范围: 10-60秒

验证结果:
  符合间隔要求(10-60秒)的轮数: 20/20
  成功率: 100.00%
```

**适用场景**:
- 实验前预览刺激分布
- 验证算法随机性
- 生成测试数据用于其他分析

### 3. pattern_analysis.md - 分布模式分析报告

**用途**: 详细分析各分布模式的可行性、成功率及优化建议

**主要内容**:
- 时间-刺激数量映射分析
- 已实现模式的详细说明（前密后疏、前疏后密、均匀随机）
- 难以实现模式的原因分析（中间密集、双峰密集）
- 失败案例详细分析
- 三种优化方案建议

**适用场景**:
- 理解算法设计原理
- 评估是否需要添加新模式
- 决策如何优化现有模式
- 查看技术细节和约束条件

## 使用方法

### 基本使用

1. 直接在浏览器中打开 `index.html` 文件
2. 阅读介绍页面，了解实验目的和流程
3. 点击"我已了解并开始实验"按钮
4. 按照程序指引完成实验

### 自定义刺激材料

#### 1. 修改刺激材料数量

编辑 `script.js` 文件，修改以下参数：

```javascript
const maxFileNumber = 20; // 根据实际文件数量设置
```

将 `20` 替换为您实际的刺激材料数量。

#### 2. 替换音频文件

将您的音频文件放入 `audio/` 目录，并按照以下格式命名：

```
stimulus_01.mp3
stimulus_02.mp3
stimulus_03.mp3
...
```

文件名必须为 `stimulus_XX.mp3` 格式，其中 `XX` 为两位数字（01, 02, 03...）。

#### 3. 替换图片文件

将您的图片文件放入 `images/` 目录，并按照以下格式命名：

```
stimulus_01.png
stimulus_02.png
stimulus_03.png
...
```

文件名必须为 `stimulus_XX.png` 格式，其中 `XX` 为两位数字（01, 02, 03...）。

**注意**：音频和图片文件的编号必须对应，例如 `stimulus_01.mp3` 对应 `stimulus_01.png`。

### 调整核心参数

编辑 `script.js` 文件，可以修改以下核心参数：

```javascript
// 焦虑诱发参数
const inductionDuration = 5;   // 刺激持续时间（秒）
const minTotalTime = 300;      // 最小总时间（5分钟 = 300秒）
const maxTotalTime = 420;      // 最大总时间（7分钟 = 420秒）
const minStimulusCount = 8;    // 最小刺激次数
const maxStimulusCount = 14;   // 最大刺激次数
const minInterval = 10;        // 最小间隔（秒）
const maxInterval = 60;        // 最大间隔（秒）
```

**注意事项**:
- 修改参数后，建议运行 `node test_algorithm.js` 验证可行性
- 如果修改间隔范围，可能需要调整分布模式的参数
- 总时间和刺激数量存在约束关系，算法会自动调整不合理请求

### 调整分布模式

编辑 `script.js` 文件中的 `distributionPatterns` 对象：

```javascript
const distributionPatterns = {
    'front_dense': {
        name: '前密后疏',
        zones: [
            { percent: 0.33, stimulusPercent: [0.40, 0.50] },
            { percent: 0.33, stimulusPercent: [0.30, 0.35] },
            { percent: 0.34, stimulusPercent: [0.20, 0.25] }
        ]
    },
    // ... 其他模式
};
```

**参数说明**:
- `percent`: 该区块占总时间的比例
- `stimulusPercent`: 该区块分配的刺激数量百分比范围 [最小, 最大]

**注意事项**:
- 所有区块的 `percent` 之和应接近1.0
- 调整后务必运行测试验证
- 过于极端的比例可能导致间隔超出范围

## 测量工具

### 视觉模拟量表（VAS）

- **评分范围**：0-100分
- **评估内容**：当前主观焦虑程度
- **计分方式**：直接使用滑块选择的数值

### 状态焦虑量表（SAI）

- **题目数量**：20题
- **评分范围**：20-80分
- **评估内容**：当前焦虑状态

## 结果评估

### 评估标准

- **VAS变化**：变化率 ≥ 20% 为显著
- **SAI变化**：变化值 ≥ 10分 为显著

### 评估结果

- **焦虑水平显著升高**：VAS或SAI任一达到显著水平
- **焦虑水平变化不显著**：VAS和SAI均未达到显著水平

## 警告与免责

### 不适宜参与人群

- 有严重精神疾病史（如焦虑症、抑郁症、PTSD等）的诊断
- 近期经历重大生活压力事件
- 怀孕期间
- 有心脑血管疾病史
- 未成年人（18岁以下）

### 免责声明

- 本程序为科学研究工具，不用于临床诊断
- 如实验过程中感到持续不适，建议停止参与并咨询专业心理医生
- 研究者不对参与实验可能产生的任何心理不适承担医疗责任
- 参与者需确认自身心理状况适合参加此类情绪诱发实验

## 数据存储

实验数据自动保存在浏览器的本地存储（localStorage）中，键名为 `anxietyInductionData`。

## 浏览器兼容性

- Chrome/Edge（推荐）
- Firefox
- Safari

## 技术实现细节

### 核心算法流程

1. **参数初始化**
   - 随机生成总时间（300-420秒）
   - 随机生成刺激数量（8-14个）
   - 随机选择分布模式

2. **时间-刺激数量映射**
   ```javascript
   function getStimulusCountRange(totalTime) {
       const minPossible = Math.ceil(totalTime / (maxInterval + inductionDuration));
       const maxPossible = Math.floor(totalTime / (minInterval + inductionDuration));
       return {
           min: Math.max(minStimulusCount, minPossible),
           max: Math.min(maxStimulusCount, maxPossible)
       };
   }
   ```
   确保刺激数量在可行范围内

3. **区块刺激分配**
   - 根据选择的分布模式划分时间区块
   - 每个区块按随机百分比分配刺激数量
   - 最后一个区块自动分配剩余刺激

4. **时间点生成**
   - 计算每个区块的第一个刺激可行时间范围
   - 在范围内随机生成刺激时间
   - 后续刺激考虑与前一刺激的间隔和剩余时间

5. **验证与调整**
   - 移除超时的刺激
   - 调整过小或过大的间隔
   - 确保时间序列递增
   - 严格验证间隔在10-60秒范围内

### 数据流

```
用户请求 → 参数生成 → 时间-刺激映射 → 区块分配 → 时间点生成 → 验证调整 → 呈现刺激
```

### 关键优化点

1. **动态映射**: 根据总时间自动调整刺激数量，避免冲突
2. **区块隔离**: 每个区块独立生成时间点，避免跨区块冲突
3. **双重验证**: 生成时预检查，生成后全面验证
4. **智能回退**: 无法满足时自动调整或移除刺激

## 许可证

本项目仅供学术研究使用。

## 联系方式

如有任何疑问或建议，请联系研究人员。